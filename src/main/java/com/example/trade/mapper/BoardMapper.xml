<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.trade.mapper.BoardMapper">
	<!-- 자주 묻는 질문(FAQ) 목록 -->
	<select id="selectFAQList" parameterType="com.example.trade.dto.Page" resultType="map">
		SELECT
			board_no AS boardNo,
			board_title AS boardTitle,
			board_content AS boardContent
		FROM board
		WHERE board_code = 'BC001'
		AND use_status = 'Y'
		<if test="searchWord != null and searchWord != ''">
			AND board_title LIKE CONCAT('%', #{searchWord}, '%')
		</if>
		ORDER BY board_no DESC
		LIMIT #{beginRow}, #{rowPerPage}
	</select>
	
	<!-- 자주 묻는 질문(FAQ) 전체 행 수 조회 -->
	<select id="selectFAQTotalCount" parameterType="com.example.trade.dto.Page" resultType="int">
		SELECT COUNT(*)
		FROM board
		WHERE board_code = 'BC001'
		AND use_status = 'Y'
		<if test="searchWord != null and searchWord != ''">
			AND board_title LIKE CONCAT('%', #{searchWord}, '%')
		</if>
	</select>
	
	<!-- 접속한 사용자의 문의 내역 -->
	<select id="selectQNAListById" parameterType="com.example.trade.dto.Page" resultType="map">
		SELECT
			board_no AS boardNo,
			board_title AS boardTitle
		FROM board
		WHERE board_code = 'BC002'
		AND create_user = #{username}
		AND use_status = 'Y'
		<if test="searchWord != null and searchWord != ''">
			AND board_title LIKE CONCAT('%', #{searchWord}, '%')
		</if>
		ORDER BY board_no DESC
		LIMIT #{beginRow}, #{rowPerPage}
	</select>
	
	<!-- 문의 내역 전체 행 수 조회 -->
	<select id="selectQNATotalCount" parameterType="com.example.trade.dto.Page" resultType="int">
		SELECT COUNT(*)
		FROM board
		WHERE board_code = 'BC002'
		AND create_user = #{username}
		AND use_status = 'Y'
		<if test="searchWord != null and searchWord != ''">
			AND board_title LIKE CONCAT('%', #{searchWord}, '%')
		</if>
	</select>
	
	<!-- 문의 내역 상세 조회 -->
	<select id="selectQNAOne" parameterType="com.example.trade.dto.Board" resultType="map">
		SELECT
			board_no AS boardNo,
			board_title AS boardTitle,
			board_content AS boardContent,
			board_code AS boardCode,
			create_user AS createUser,
			create_date AS createDate,
			update_user AS updateUser,
			update_date AS updateDate,
			use_status AS useStatus,
			view_count AS viewCount
		FROM board
		WHERE board_no = #{boardNo}
		AND board_code = 'BC002'
		AND create_user = #{createUser}
		AND use_status = 'Y'
	</select>
	
	<!-- 1:1 문의 등록 -->
	<insert id="insertBoard" parameterType="com.example.trade.dto.Board" useGeneratedKeys="true" keyProperty="boardNo">
		INSERT INTO board (
			board_title, board_content, board_code, create_user
		) VALUES (
			#{boardTitle}, #{boardContent}, #{boardCode}, #{createUser}
		)
	</insert>
	
	<!-- 1:1 문의 수정 -->
	<update id="updateQNA" parameterType="com.example.trade.dto.Board">
		UPDATE board SET
			board_title = #{boardTitle},
			board_content = #{boardContent},
			update_user = #{updateUser},
			update_date = NOW()
		WHERE board_no = #{boardNo}
		AND board_code = 'BC002'
		AND create_user = #{updateUser}
	</update>
	
	<!-- 1:1 문의 삭제(비활성화) -->
	<update id="deleteQNA" parameterType="com.example.trade.dto.Board">
		UPDATE board SET
			update_user = #{updateUser},
			update_date = NOW(),
			use_status = 'N'
		WHERE board_no = #{boardNo}
		AND board_code = 'BC002'
		AND create_user = #{updateUser}
	</update>
	
	<!-- 댓글 조회 -->
	<select id="selectCommentByBoardNo" parameterType="int" resultType="map">
		SELECT
			comment_no AS commentNo,
			parent_comment_no AS parentCommentNo,
			comment_content AS commentContent,
			board_no AS boardNo,
			create_user AS createUser,
			create_date AS createDate,
			update_user AS updateUser,
			update_date AS updateDate,
			use_status AS useStatus
		FROM comment
		WHERE board_no = #{boardNo}
		AND use_status = 'Y'
		ORDER BY COALESCE(parent_comment_no, comment_no), comment_no
	</select>
	
	<!-- 댓글 등록 -->
	<insert id="insertComment" parameterType="com.example.trade.dto.Comment">
		INSERT INTO comment (
			parent_comment_no, comment_content, board_no, create_user
		)
		VALUES (
			#{parentCommentNo}, #{commentContent}, #{boardNo}, #{createUser}
		)
	</insert>
	
	<!-- 댓글 수정 -->
	<update id="updateComment" parameterType="com.example.trade.dto.Comment">
		UPDATE comment SET
			comment_content = #{commentContent},
			update_user = #{updateUser},
			update_date = NOW()
		WHERE comment_no = #{commentNo}
		AND board_no = #{boardNo}
		AND use_status = 'Y'
	</update>
	
	<!-- 댓글 삭제 -->
	<update id="deleteComment">
		UPDATE comment SET
			update_user = #{updateUser},
			update_date = NOW(),
			use_status = 'N'
		WHERE comment_no = #{commentNo}
		AND board_no = #{boardNo}
		AND create_user = #{updateUser}
	</update>
	
	<!-- 공지사항 목록 조회 -->
	<select id="selectNoticeList" parameterType="com.example.trade.dto.Page" resultType="map">
		SELECT
			board_no AS boardNo,
			board_title AS boardTitle,
			create_date AS createDate,
			view_count AS viewCount
		FROM board
		WHERE board_code = 'BC003'
		AND use_status = 'Y'
		<if test="searchWord != null and searchWord != ''">
			AND board_title LIKE CONCAT('%', #{searchWord}, '%')
		</if>
		ORDER BY board_no DESC
		LIMIT #{beginRow}, #{rowPerPage}
	</select>
	
	<!-- 공지사항 전체 행 수 조회 -->
	<select id="selectNoticeTotalCount" parameterType="com.example.trade.dto.Page" resultType="int">
		SELECT COUNT(*)
		FROM board
		WHERE board_code = 'BC003'
		AND use_status = 'Y'
		<if test="searchWord != null and searchWord != ''">
			AND board_title LIKE CONCAT('%', #{searchWord}, '%')
		</if>
	</select>
	
	<!-- 공지사항 상세 조회 -->
	<select id="selectNoticeOne" parameterType="int" resultType="map">
		SELECT
			board_no AS boardNo,
			board_title AS boardTitle,
			board_content AS boardContent,
			board_code AS boardCode,
			create_user AS createUser,
			create_date AS createDate,
			update_user AS updateUser,
			update_date AS updateDate,
			use_status AS useStatus,
			view_count AS viewCount
		FROM board
		WHERE board_no = #{boardNo}
		AND use_status = 'Y'
	</select>
</mapper>